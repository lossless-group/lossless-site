---
/**
 * ClientListHorizontalScroller--stealth.astro
 * 
 * Horizontal scrolling container for stealth client cards
 * Shows stealth information instead of public client details
 * 
 * PROPS:
 * - clients (array, required): Array of client objects with stealth properties:
 *   - stealth-name: string
 *   - stealth-logo?: string  
 *   - stealth-description: string
 *   - industry: string
 *   - engagement: string
 *   - (stealth-passcode is excluded for security)
 * - title (string, optional): Section title (defaults to "Confidential Projects")
 */

import ClientCardSm from './ClientCard--sm--stealth.astro';
import GlassmorphicNavButton from '../navigation/GlassmorphicNavButton.astro';

interface Client {
  id: string;
  "stealth-name": string;
  "stealth-logo"?: string;
  "stealth-description": string;
  industry: string;
  engagement: string;
  // Note: stealth-passcode is intentionally excluded
}

interface Props {
  clients: Client[];
  title?: string;
}

const { clients, title = "Current Work" } = Astro.props;
---

<section class="stealth-client-list-section">
  <div class="section-header">
    <GlassmorphicNavButton 
      direction="left" 
      label="Previous clients"
      onClick="window.scrollStealthClientsLeft()"
      class="nav-left"
    />
    <h2 class="section-title">{title}</h2>
    <GlassmorphicNavButton 
      direction="right" 
      label="Next clients"
      onClick="window.scrollStealthClientsRight()"
      class="nav-right"
    />
  </div>
  <div class="clients-container">
    <div class="clients-scroll">
      {clients.map((client, index) => (
        <ClientCardSm 
          name={client["stealth-name"]}
          logo={client["stealth-logo"]}
          description={client["stealth-description"]}
          industry={client.industry}
          engagement={client.engagement}
          clientId={client.id}
          data-index={index}
        />
      ))}
    </div>
  </div>
</section>

<style>
  .stealth-client-list-section {
    margin-bottom: 5rem;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 2rem;
    margin-top: 2rem;
    position: relative;
    gap: 2rem;
    flex-direction: row;
  }
  
  .section-title {
    font-size: 2rem;
    font-weight: 700;
    color: #f1f5f9;
    margin: 0;
    text-align: center;
  }
  
  .nav-left {
    position: absolute;
    left: 0;
  }
  
  .nav-right {
    position: absolute;
    right: 0;
  }
  
  /* Clients Container */
  .clients-container {
    position: relative;
    margin: 2rem -1rem;
    padding: 0 1rem;
    max-width: 100vw;
    overflow: hidden;
  }
  
  .clients-scroll {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 1rem calc(50% - 160px) 2rem calc(50% - 160px);
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    max-width: 100vw;
  }

  /* JavaScript to center the middle card on load */
  
  .clients-scroll > :global(*) {
    scroll-snap-align: center;
    flex-shrink: 0;
    height: 300px; /* Increased height to show all text */
    overflow: visible; /* Allow text to be fully visible */
  }
  
  /* Custom Scrollbar Styling */
  .clients-scroll::-webkit-scrollbar {
    height: 8px;
  }
  
  .clients-scroll::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
  }
  
  .clients-scroll::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
  }
  
  .clients-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
  }
  
  /* Firefox Scrollbar */
  @supports (scrollbar-width: thin) {
    .clients-scroll {
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.2) rgba(255, 255, 255, 0.05);
    }
  }
  
  /* Mobile Adjustments */
  @media (max-width: 768px) {
    .section-header {
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-direction: row; /* Ensure horizontal layout */
    }
    
    .section-title {
      font-size: 1.5rem;
    }
    
    .nav-left {
      position: relative;
      left: auto;
    }
    
    .nav-right {
      position: relative;
      right: auto;
    }
    
    .clients-container {
      margin: 1rem 0;
      max-width: 100vw;
      overflow: hidden;
      padding: 0;
    }
    
    .clients-scroll {
      gap: 0.75rem;
      padding: 0.5rem 1rem 1.5rem 1rem;
      max-width: 100vw;
      /* Remove center padding on mobile to use full width */
      padding-left: 1rem;
      padding-right: 1rem;
      /* Ensure smooth scrolling on mobile */
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    
    /* Adjust card sizing for mobile */
    .clients-scroll > :global(*) {
      min-width: 300px;
      max-width: 300px;
      height: 300px; /* Increased height to show all text */
      flex-shrink: 0;
      overflow: visible; /* Allow text to be fully visible */
    }
  }
  
  /* Extra small mobile adjustments */
  @media (max-width: 480px) {
    .section-header {
      flex-direction: row; /* Keep horizontal layout even on small screens */
      gap: 0.75rem;
      align-items: center;
    }
    
    .section-title {
      font-size: 1.25rem;
      order: 0; /* Remove order change */
    }
    
    .clients-scroll {
      gap: 0.5rem;
      padding: 0.5rem 0.75rem 1rem 0.75rem;
    }
    
    /* Smaller cards for very small screens */
    .clients-scroll > :global(*) {
      min-width: 280px;
      max-width: 280px;
      height: 300px; /* Increased height to show all text */
      overflow: visible; /* Allow text to be fully visible */
    }
  }
</style>

<script>
  // Center the middle card on page load and setup navigation
  document.addEventListener('DOMContentLoaded', () => {
    const scrollContainer = document.querySelector('.stealth-client-list-section .clients-scroll');
    if (scrollContainer) {
      const cards = scrollContainer.children;
      const middleIndex = Math.floor(cards.length / 2);
      const middleCard = cards[middleIndex] as HTMLElement;
      
      if (middleCard) {
        // Scroll to center the middle card within its container only
        // Use scrollLeft instead of scrollIntoView to avoid page-level scrolling
        const cardRect = middleCard.getBoundingClientRect();
        const containerRect = scrollContainer.getBoundingClientRect();
        const scrollLeft = middleCard.offsetLeft - (scrollContainer.clientWidth / 2) + (middleCard.offsetWidth / 2);
        scrollContainer.scrollLeft = scrollLeft;
      }
      
      // Setup global navigation functions
      window.scrollStealthClientsLeft = () => {
        // Get the first card to determine current card width
        const firstCard = scrollContainer.children[0] as HTMLElement;
        const cardWidth = firstCard ? firstCard.offsetWidth + 24 : 344; // fallback to 320 + 24
        scrollContainer.scrollBy({ 
          left: -cardWidth, 
          behavior: 'smooth' 
        });
      };
      
      window.scrollStealthClientsRight = () => {
        // Get the first card to determine current card width
        const firstCard = scrollContainer.children[0] as HTMLElement;
        const cardWidth = firstCard ? firstCard.offsetWidth + 24 : 344; // fallback to 320 + 24
        scrollContainer.scrollBy({ 
          left: cardWidth, 
          behavior: 'smooth' 
        });
      };
    }
  });
</script>