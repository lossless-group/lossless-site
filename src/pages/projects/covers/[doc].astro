---
import Layout from '@layouts/Layout.astro';
import Hero from '@components/basics/Hero.astro';
import AnimationWrapper from '@components/basics/AnimationWrapper.astro';
import Section__Project_Container from '@components/projects/Section__Project-Container.astro';

import ContentSection_SidebarTreeVariantB from '@layouts/content-sections/ContentSection_SidebarTreeVariantB.astro';
import OneArticle from '@layouts/OneArticle.astro';
import OneArticleOnPage from '@components/articles/OneArticleOnPage.astro';

import mdWorkflow from '@generated/projects/Augment-It/Specs/Data Augmentation Workflow with Microfrontends.md?raw';
import mdRecordCollector from '@generated/projects/Augment-It/Specs/apps-microfrontends/RecordCollector.md?raw';
import mdPromptTemplateManager from '@generated/projects/Augment-It/Specs/apps-microfrontends/PromptTemplateManager.md?raw';
import mdRequestReviewer from '@generated/projects/Augment-It/Specs/apps-microfrontends/RequestReviewer.md?raw';
import mdHighlightCollector from '@generated/projects/Augment-It/Specs/apps-microfrontends/HighlightCollector.md?raw';
import mdApiConnectorService from '@generated/projects/Augment-It/Specs/shared-services/apiConnectorService.md?raw';

export async function getStaticPaths() {
  // Pre-render known document routes under /projects/covers/
  const docs = [
    'record-collector',
    'prompt-template-manager',
    'api-connector-service',
    'request-reviewer',
    'highlight-collector',
  ];
  return docs.map((doc) => ({ params: { doc } }));
}

const selected = Astro.params.doc || 'workflow';

const demoSteps = [
  { title: 'Data Augmentation Workflow with Microfrontends', href: '/projects/covers' },
  { title: 'Load Data', href: '/projects/covers/record-collector' },
  { title: 'Review & Enrich Records', href: '/projects/covers/record-collector' },
  { title: 'Author Prompt Templates', href: '/projects/covers/prompt-template-manager' },
  { title: 'Choose AI Augmentation Option', href: '/projects/covers/api-connector-service' },
  { title: 'Review Request & Response', href: '/projects/covers/request-reviewer' },
  { title: 'Generate Insights', href: '/projects/covers/highlight-collector' },
  { title: 'Sync Back to Source', href: '/projects/Augment-It/sync' },
];

const currentHref = selected === 'workflow'
  ? '/projects/covers'
  : `/projects/covers/${selected}`;

const articles = {
  'workflow': {
    md: mdWorkflow,
    id: 'Augment-It/Specs/Data Augmentation Workflow with Microfrontends.md',
    title: 'Data Augmentation Workflow with Microfrontends',
  },
  'record-collector': {
    md: mdRecordCollector,
    id: 'Augment-It/Specs/apps-microfrontends/RecordCollector.md',
    title: 'Load Data — RecordCollector',
  },
  'prompt-template-manager': {
    md: mdPromptTemplateManager,
    id: 'Augment-It/Specs/apps-microfrontends/PromptTemplateManager.md',
    title: 'Author Prompt Templates — PromptTemplateManager',
  },
  'request-reviewer': {
    md: mdRequestReviewer,
    id: 'Augment-It/Specs/apps-microfrontends/RequestReviewer.md',
    title: 'Review Request & Response — RequestReviewer',
  },
  'highlight-collector': {
    md: mdHighlightCollector,
    id: 'Augment-It/Specs/apps-microfrontends/HighlightCollector.md',
    title: 'Generate Insights — HighlightCollector',
  },
  'api-connector-service': {
    md: mdApiConnectorService,
    id: 'Augment-It/Specs/shared-services/apiConnectorService.md',
    title: 'Choose AI Augmentation Option — apiConnectorService',
  },
} as const;

const currentArticle = articles[selected] ?? articles['workflow'];
// Remove YAML frontmatter when using ?raw imports so it doesn't render in the page
function stripFrontmatter(input: string): string {
  if (!input) return input;
  return input.replace(/^\uFEFF?\s*---[\s\S]*?\n---\s*/u, '');
}
const cleanedContent = stripFrontmatter(currentArticle.md);
---

<Layout 
  title="Our Lossless Projects" 
  description="Explore our innovative projects and interactive visualizations"
>
  <!-- Full-page document view that takes over entire layout -->
  <div class="doc-fullpage-takeover">
    <nav class="doc-nav">
      <a class="back-link" href="/projects/covers">← Back to covers</a>
      <button 
        type="button" 
        class="collapse-btn" 
        aria-label="Close expanded content"
        onclick="window.location.href='/projects/covers'"
      >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </nav>
    <ContentSection_SidebarTreeVariantB steps={demoSteps} {currentHref} seriesTitle="Augment-It">
      <OneArticle
        Component={OneArticleOnPage}
        content={cleanedContent}
        markdownFile={currentArticle.id}
        data={{ path: Astro.url.pathname, id: currentArticle.id, title: currentArticle.title }}
        title={currentArticle.title}
      />
    </ContentSection_SidebarTreeVariantB>
  </div>
</Layout>

<style>
  .doc-fullpage-takeover {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--surface-1, #1a1a1a);
    z-index: 1000;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  
  .doc-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--clr-lossless-ui-btn-border);
    background: var(--surface-2);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .back-link {
    text-decoration: none;
    font-size: 0.95rem;
    color: var(--clr-body);
    border: 1px solid var(--clr-lossless-ui-btn-border);
    padding: 0.35rem 0.6rem;
    border-radius: 8px;
    background: var(--surface-2);
  }
  
  .back-link:hover {
    color: var(--clr-heading);
    background: var(--clr-lossless-primary-glass);
  }
  
  .collapse-btn {
    background: none;
    border: none;
    color: var(--clr-body);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: color 160ms ease, background 160ms ease;
  }
  
  .collapse-btn:hover {
    color: var(--clr-heading);
    background: var(--clr-lossless-primary-glass);
  }
  
  .collapse-btn svg {
    width: 1.5rem;
    height: 1.5rem;
    display: block;
  }
</style>
