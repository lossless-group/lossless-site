---
import { getCollection, render } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import OneArticle from '@layouts/OneArticle.astro';
import OneArticleOnPage from '@components/articles/OneArticleOnPage.astro';
import { processEntries, getReferenceSlug } from '@utils/slugify';

export const prerender = true;

export async function getStaticPaths() {
  const allProjects = await getCollection('projects', ({ data }) => {
    return data.publish === true;
  });



  const allPaths = allProjects.map(entry => {
    const generatedSlug = getReferenceSlug(entry.id);
    
    return {
      params: { slug: generatedSlug },
      props: {
        entry
      }
    };
  });

  return allPaths;
}

const { entry } = Astro.props;
const { slug } = Astro.params;

const contentData = {
  ...entry.data,
  path: Astro.url.pathname,
  id: entry.id,
  slug: slug,
};
---

<Layout frontmatter={entry.data}>
  <OneArticle 
    Component={OneArticleOnPage}
    title={entry.data.title}
    data={contentData}
    content={entry.body}
    markdownFile={entry.id}
  />
</Layout>
