---
import ReferenceLayout from '@layouts/ReferenceLayout.astro';
import { getCollection } from 'astro:content';
import { processEntries } from '@utils/slugify';
import ConceptPreviewCard from '@components/reference/ConceptPreviewCard.astro';

// Get entries from concepts collection and process them using the centralized function
const rawEntries = await getCollection('concepts');
const processedEntries = processEntries(rawEntries);

// Filter out any entries without a title and add missing properties
const validEntries = processedEntries
  .filter(entry => entry.data.title)
  .map(entry => ({
    ...entry,
    originalFilename: entry.id.split('/').pop()?.replace(/\.(md|mdx)$/, '') || entry.id,
    body: entry.body || ''
  }));

// Use the valid entries for rendering
const entriesToRender = validEntries;
---

<ReferenceLayout 
  title="Concepts"
  description="Important ideas and frameworks we use in our work."
  currentPage="concepts"
  showSearch={true}
  showGrid={false}
>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {entriesToRender.map(entry => (
      <div data-searchable="true">
        <ConceptPreviewCard entry={entry} />
      </div>
    ))}
  </div>
</ReferenceLayout>
